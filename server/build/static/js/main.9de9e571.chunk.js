(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{120:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(55),c=n.n(a),o=n(13),s=n(58),u=n(2),l=n(15),i=n(6),j=n.n(i),b=n(14),h=function(e){var t=Object(r.useState)(""),n=Object(o.a)(t,2),a=n[0],c=n[1];return{type:e,value:a,onChange:function(e){e.preventDefault(),c(e.target.value)},onSubmit:function(){c("")}}},p=n(12),d=n.n(p),x=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.post("http://localhost:3001/api/users/login",{username:t,password:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=n(0),f=function(e){var t=e.onLogin,n=h("text"),r=h("password"),a=function(){var e=Object(b.a)(j.a.mark((function e(a){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),e.prev=1,!(n.value.length>1&&r.value.length>1)){e.next=9;break}return e.next=5,x(n.value,r.value);case 5:c=e.sent,t(JSON.stringify(c.data)),e.next=10;break;case 9:alert("input not allowed, username and password must both be at least of length 1");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),alert("incorrect username or password");case 15:n.onSubmit(),r.onSubmit();case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:"Enter"}),Object(O.jsx)("p",{children:"If you have an existing account you will be logged in"}),Object(O.jsx)("p",{children:"If you don't have an existing account one will be created for you and you will be logged in automatically"}),Object(O.jsx)("p",{children:"Note: you cannot change your username or password once your account has been created"}),Object(O.jsxs)("form",{onSubmit:a,children:[Object(O.jsxs)("label",{children:["Username: ",Object(O.jsx)("input",Object(l.a)({},n))]}),Object(O.jsx)("br",{}),Object(O.jsxs)("label",{children:["Password: ",Object(O.jsx)("input",Object(l.a)({},r))]}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{type:"submit",children:"Enter"})]})]})},m=function(){var e=JSON.parse(localStorage.getItem("loggedInUser"));return{headers:{Authorization:"bearer ".concat(e.token)}}},g=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.post("http://localhost:3001/api/groups/join",{group_name:t,passphrase:n,username:r},a);case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),v=function(e){var t=e.username,n=h("text"),a=h("password"),c=Object(r.useState)([]),s=Object(o.a)(c,2),u=s[0],i=s[1],p=m();Object(r.useEffect)((function(){var e=m();d.a.post("http://localhost:3001/api/groups/list",{username:t},e).then((function(e){return i(e.data)}))}),[t]);var x=function(){var e=Object(b.a)(j.a.mark((function e(r){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),e.prev=1,!(n.value.length>1||a.value.length>1)){e.next=9;break}if(u.includes(n.value)){e.next=6;break}return e.next=6,g(n.value,a.value,t,p);case 6:f(n.value),e.next=10;break;case 9:alert("input not allowed, groupname and passphrase must both be at least of length 1");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),alert(e.t0);case 15:n.onSubmit(),a.onSubmit();case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),f=function(e){window.location.href="http://localhost:3000/chat/".concat(e)};return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:"Join Group"}),Object(O.jsxs)("h2",{children:["List of groups for ",t]}),u.length>0?u.map((function(e){return Object(O.jsx)("div",{children:Object(O.jsxs)("button",{onClick:function(t){t.preventDefault(),f(e)},children:['Enter chat room for "',e,'"']})})})):Object(O.jsx)("p",{children:"You aren't in any groups...YET :)"}),Object(O.jsx)("p",{children:"If the group exists you will be allowed in"}),Object(O.jsx)("p",{children:"If the group does not exist, one will be created and you will be allowed in"}),Object(O.jsxs)("form",{onSubmit:x,children:[Object(O.jsxs)("label",{children:["Group name: ",Object(O.jsx)("input",Object(l.a)(Object(l.a)({},n),{},{autoFocus:!0}))]}),Object(O.jsx)("br",{}),Object(O.jsxs)("label",{children:["Passphrase: ",Object(O.jsx)("input",Object(l.a)({},a))]}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{type:"submit",children:"Enter"})]})]})},w={overflowY:"scroll",border:"1px solid black",width:"300px",height:"300px",position:"relative"},y=function(e){var t=e.socket,n=e.user_name,a=Object(u.g)().room_name,c=Object(r.useState)([]),s=Object(o.a)(c,2),l=s[0],i=s[1],j=m(),b=Object(r.useState)(""),h=Object(o.a)(b,2),p=h[0],x=h[1];Object(r.useEffect)((function(){d.a.post("http://localhost:3001/api/groups/exp",{group_name:a},j).then((function(e){x(e.data[0].expiry_date)})).then(t.emit("joinRoom",{user_name:n,room_name:a}))}),[]);t.on("message",(function e(){var n=l.concat(arguments.length<=0?void 0:arguments[0]);v(),i(n),t.off("message",e)}));var f=function(e){e.preventDefault(),t.emit("chat",{message:e.target.value,user_name:n,room_name:a}),document.getElementById("form").reset()},g=Object(r.useRef)(null),v=function(){g.current.scrollIntoView({behavior:"auto"})};return Object(O.jsxs)("div",{children:[Object(O.jsxs)("h3",{children:["Chat room for ",a]}),Object(O.jsxs)("p",{children:["This room will expire at ",p]}),Object(O.jsx)("button",{onClick:function(e){e.preventDefault(),t.emit("disconnect_room",{user_name:n,room_name:a}),window.location.href="http://localhost:3000/groups"},children:"Click to go back to groups"}),Object(O.jsxs)("div",{style:w,children:[l.map((function(e){return Object(O.jsxs)("p",{children:[e.username,": ",e.message]})})),Object(O.jsx)("div",{ref:g})]}),Object(O.jsxs)("form",{onSubmit:f,id:"form",children:[Object(O.jsx)("label",{children:Object(O.jsx)("input",{autoFocus:!0,defaultValue:"",type:"text",onKeyPress:function(e){"Enter"===e.key&&f(e)}})}),Object(O.jsx)("button",{type:"submit",children:"Send"}),Object(O.jsx)("br",{})]})]})},k=n(90),S=function(){var e=Object(r.useState)(null),t=Object(o.a)(e,2),n=t[0],a=t[1];Object(r.useEffect)((function(){try{var e=JSON.parse(localStorage.getItem("loggedInUser")),t={token:e.token};d.a.post("http://localhost:3001/api/users/auth",t).then((function(t){"valid"===t.data?a(e):a(null)}))}catch(n){a(null)}}),[]);var c=k("localhost:3001");return Object(O.jsx)(s.a,{children:Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)("h1",{children:"30 Chat"}),n?Object(O.jsxs)("p",{children:["Currently logged in as ",n.username,Object(O.jsx)("button",{onClick:function(){window.localStorage.removeItem("loggedInUser"),a(null),window.location.href="http://localhost:3000/"},children:"Logout"})]}):null,Object(O.jsxs)(u.d,{children:[Object(O.jsx)(u.b,{path:"/chat/:room_name",children:n?Object(O.jsx)(y,{socket:c,user_name:n.username}):Object(O.jsx)("p",{children:"'loading'"})}),Object(O.jsx)(u.b,{path:"/groups",children:null===n?Object(O.jsx)(u.a,{to:"/login"}):Object(O.jsx)(v,{username:n.username,socket:c})}),Object(O.jsx)(u.b,{path:"/login",children:null===n?Object(O.jsx)(f,{onLogin:function(e){window.localStorage.setItem("loggedInUser",e),a(JSON.parse(localStorage.getItem("loggedInUser")))}}):Object(O.jsx)(u.a,{to:"/groups"})}),Object(O.jsx)(u.b,{path:"/",children:null===n?Object(O.jsx)(u.a,{to:"/login"}):Object(O.jsx)(u.a,{to:"/groups"})})]})]})})};c.a.render(Object(O.jsx)(S,{}),document.getElementById("root"))}},[[120,1,2]]]);
//# sourceMappingURL=main.9de9e571.chunk.js.map